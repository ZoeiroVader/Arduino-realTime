
<!DOCTYPE html>
<html>
<head>
    <title>Temperature Plot</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="configs/style.css">
    <link href="https://fonts.googleapis.com/css?family=ZCOOL+XiaoWei" rel="stylesheet"> 
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
</head>
<body>
    <h4>Date: <span id="date"></span></h4>
    <div class="chart-container">
        <canvas id="temperatura"></canvas>
    </div>
    <div class="chart-container">
        <canvas id="umidade"></canvas>
    </div>
    <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
    <script>

        var socket = io.connect('http://localhost:4000'); //Se conecta ao servidor
        
        var temper = document.getElementById('temperatura').getContext('2d');
        var t1 = new Chart(temper, {
            // O tipo de gráfico que será criado
            type: 'line',
            // As configurações do gráfico
            data: {
            labels: [],
            datasets: [{
                label: "Temperatura",
                borderColor: "#af2828",
                data: [],
                fill: false,
                pointStyle: 'circle',
                backgroundColor: '#af2828',
                pointRadius: 5,
                pointHoverRadius: 7,
                lineTension: 0,
            }]
            },
            // Aqui será Configurado o título do gráfico e deixá-lo responsivo
            options: {
                responsive: true,
                hoverMode: 'index',
                stacked: false,
                title: {
                    display: true,
                    text: 'Gráfico de Temperatura',
                    fontSize: 30,
                    fontColor: "#af2828",
                    fontFamily: " 'ZCOOL XiaoWei', serif",
                    fontStyle: "normal"
                },
            }
            
        });

        var umid = document.getElementById('umidade').getContext('2d');
        var u1 = new Chart(umid, {
            // O tipo de gráfico que será criado
            type: 'line',
            // As configurações do gráfico
            data: {
            labels: [],
            datasets: [{
                label: "Umidade",
                borderColor: "#4573a1",
                data: [],
                fill: false,
                pointStyle: 'circle',
                backgroundColor: '#3498DB',
                pointRadius: 5,
                pointHoverRadius: 7,
                lineTension: 0,
            }]
            },
            // Aqui será Configurado o título do gráfico e deixá-lo responsivo
            options: {
					responsive: true,
					hoverMode: 'index',
					stacked: false,
					title: {
						display: true,
                        text: 'Gráfico de Umidade',
                        fontSize: 30,
                        fontColor: "#3498DB",
                        fontFamily: " 'ZCOOL XiaoWei', serif",
                        fontStyle: "normal"
                    },
            }
            
        });

        socket.on('temp', function(data) { //Assim q o temp é recebido

            var dados = data.temp.split(","); //Tranforma as temperaturas recebidas em um vetor de duas posições e usa a virgula como separador
            // o resultado dessa operação será dados = [ 0 : "temperatura", 1 : "umidade"] 

            date.innerHTML = data.date; //Define a data

            if(t1.data.labels.length != 15) { //Se houver menos de 15 dados
                t1.data.labels.push(data.time);  //Coloca o horário no eixo X
                t1.data.datasets.forEach((dataset) => {
                    dataset.data.push(dados[0]); //Adiciona a temperatura no eixo Y
                });
            }
            else {
                t1.data.labels.shift(); //Remove o primeiro horário
                t1.data.labels.push(data.time); //Insere a data atual
                t1.data.datasets.forEach((dataset) => {
                    dataset.data.shift(); //Remove o primeiro registro de tempertura
                    dataset.data.push(dados[0]); //Insere um novo registro de temperatura
                });
            }
            t1.update(); //Atualiza o gráfico 

            if(u1.data.labels.length != 15) { //Se houver menos de 15 dados
                u1.data.labels.push(data.time);  //Coloca o horário no eixo X
                u1.data.datasets.forEach((dataset) => {
                    dataset.data.push(dados[1]); //Adiciona a temperatura no eixo Y
                });
            }
            else {
                u1.data.labels.shift(); //Remove o primeiro horário
                u1.data.labels.push(data.time); //Insere a data atual
                u1.data.datasets.forEach((dataset) => {
                    dataset.data.shift(); //Remove o primeiro registro de tempertura
                    dataset.data.push(dados[1]); //Insere um novo registro de temperatura
                });
            }
            u1.update(); //Atualiza o gráfico 
        });
    </script>
</body>
</html>